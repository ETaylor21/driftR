<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Applying Drift Corrections with driftR • driftR</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">driftR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/driftR.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/TidyEval.html">Tidy Evaluation in driftR</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/shaughnessyar/driftR">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Applying Drift Corrections with driftR</h1>
                        <h4 class="author">Andrew Shaughnessy, Christopher Prener, Elizabeth Hasenmueller</h4>
            
            <h4 class="date">2017-10-24</h4>
          </div>

    
    
<div class="contents">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(driftR)</code></pre></div>
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>In-situ water-quality monitoring intruments take a continuous measurements of a various chemical and physical parameters. The longer these intruments are allowed to stay in the field, the further the readings of the various sensors drift from the true value of the parameter. The purpose of this package is to correct water-quality monotoring datasets for instrumental drift in a reliable, reproducable method.</p>
</div>
<div id="equations" class="section level2">
<h2 class="hasAnchor">
<a href="#equations" class="anchor"></a>Equations</h2>
<p>The equations that are implemented were originally published as part of <a href="https://hasenmuellerlab.weebly.com">Dr. Elizabeth Hasenmueller’s</a> <a href="http://openscholarship.wustl.edu/cgi/viewcontent.cgi?article=1584&amp;amp=&amp;context=etd&amp;amp=&amp;sei-redir=1&amp;referer=https%253A%252F%252Fscholar.google.com%252Fscholar%253Fhl%253Den%2526as_sdt%253D0%25252C26%2526q%253Dhasenmueller%252Bwash%252Bu%2526btnG%253D#search=%22hasenmueller%20wash%20u%22">dissertation research</a> (see page 32).</p>
<div id="one-point-calibration" class="section level3">
<h3 class="hasAnchor">
<a href="#one-point-calibration" class="anchor"></a>One-Point Calibration</h3>
<p>The one-point calibration equation is as follows:</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/shaughnessyar/driftR/master/man/figures/onePointCorrection.png">
</div>
</div>
<div id="two-point-calibration" class="section level3">
<h3 class="hasAnchor">
<a href="#two-point-calibration" class="anchor"></a>Two-Point Calibration</h3>
<p>The two-point calibration equation is as follows:</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/shaughnessyar/driftR/master/man/figures/twoPointCorrection.png">
</div>
</div>
</div>
<div id="using-driftr" class="section level2">
<h2 class="hasAnchor">
<a href="#using-driftr" class="anchor"></a>Using driftR</h2>
<p>There are five main functions in the <code>driftR</code> which each serve their own purpose in data cleaning process:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="../reference/dr_readSonde.html">dr_readSonde()</a></code> - import data from the Sonde</li>
<li>
<code>dr_correct()</code> - apply correction factors</li>
<li>
<code>dr_clean1()</code> - one point calibration</li>
<li>
<code>dr_clean2()</code> - two point claibration</li>
<li>
<code><a href="../reference/dr_drop.html">dr_drop()</a></code> - drop observations to account for equilibration</li>
</ol>
<div id="importing-data" class="section level3">
<h3 class="hasAnchor">
<a href="#importing-data" class="anchor"></a>Importing data</h3>
<p>First, to import a dataset, the <code>dr_sondeClean(fileExtention, defineVar= FALSE)</code> function will be utilized. The aregument <code>fileExtention</code> tells the function where the data is located. The argument <code>defineVar</code> is a logical statement where if <code>FALSE</code>, the data will be imported raw with no modifications and if <code>TRUE</code>, the “units” abservation will be removed and the different variables will be defined as the correct data type (i.e. Date as a date variable, Time as a time variable, everything else as a numberic variable). Using <code>defineVar = TRUE</code> will format the date as Year-Month-Day.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dr_readSonde.html">dr_readSonde</a></span>(<span class="kw">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"rawData.csv"</span>, <span class="dt">package =</span> <span class="st">"driftR"</span>), <span class="dt">defineVar =</span> <span class="ot">TRUE</span>)</code></pre></div>
</div>
<div id="creating-correction-factors" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-correction-factors" class="anchor"></a>Creating correction factors</h3>
<p>The next step in the data cleaning process is creating correction factors using <code>dr_correct(dataFrame, dateVar, timeVar, format)</code>. The correction factors that are generated are used to determine how much of the total drift is experienced by each observation for the total dataset. The argument <code>dataFrame</code> is the working data frame for the correction. The argument <code>dateVar</code> is the date variable for the dataset and <code>timeVar</code> is the time variable. The argument <code>format</code> describes the way that the date data is stored in the data frame and can be either “YMD” or “DMY”. If the <code><a href="../reference/dr_readSonde.html">dr_readSonde()</a></code> function is used to import the data, then <code>format = "MDY"</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">corrFactors &lt;-<span class="st"> </span><span class="kw">dr_correct</span>(df, Date, Time, <span class="dt">format =</span> <span class="st">"MDY"</span>)</code></pre></div>
</div>
<div id="cleaning-the-data" class="section level3">
<h3 class="hasAnchor">
<a href="#cleaning-the-data" class="anchor"></a>Cleaning the data</h3>
<p>After creating the correction factors, we can begin cleaning the data for drift. In order to correct the data, there needs to be some measurement taken that tells the user what the instrument should be reading and what the instrument is actually reading. This step can be done with either one or two standard measurements. If one standard measurement is taken, then the function <code>dr_clean1(dataFrame,varName,calVal,calStd,correctVar)</code> will be used. The argument <code>dataFrame</code> is the working data frame for the correction and <code>varName</code> is the variable name that you want to correct. The arguments <code>calVal</code> and <code>calStd</code> are what the instrument was reading and what it should have been reading respecively. The <code>correctVar</code> argument is the result generated from the <code>dr_correct()</code> function.</p>
<p>If two standard measurements are taken, then the function <code>dr_clean2(dataFrame,varName,calValLow,calStdLow,calValHigh,calStdHigh,correctVar)</code> is utilized. The <code>calValLow</code> and <code>calValHigh</code> arguments are what the instrument was reading for the low and high concentration measurements respectively and the <code>calStdLow</code> and <code>calStdHigh</code> areguments are what the instrument should have been reading for the low and high concentration measurements respectively.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df<span class="op">$</span>SpCond_Corr &lt;-<span class="st"> </span><span class="kw">dr_clean1</span>(df, SpCond, <span class="fl">1.07</span>, <span class="dv">1</span>, corrFactors)
df<span class="op">$</span>pH_Corr &lt;-<span class="st"> </span><span class="kw">dr_clean2</span>(df, pH, <span class="fl">7.01</span>, <span class="dv">7</span>, <span class="fl">11.8</span>, <span class="dv">10</span>, corrFactors)</code></pre></div>
</div>
<div id="dropping-data" class="section level3">
<h3 class="hasAnchor">
<a href="#dropping-data" class="anchor"></a>Dropping Data</h3>
<p>After the data has been cleaned, some of the data will need to be dropped in order to account for equilibration of the sensors as well as time out of the water during calibration. It is important to do this step last because dropping data before using <code>dr_clean1()</code> or <code>dr_clean2()</code> will result in the corrections being non-consistant. To do this, the <code><a href="../reference/dr_drop.html">dr_drop(dataFrame,head=NULL,tail=NULL)</a></code> function will be used. The argument <code>dataFrame</code> is the working data frame for the correction. The arguments <code>head</code> and <code>tail</code> are the number of observations to be dropped from the begining and the end of the dataset respectively. It is recommended that at least 30 minutes are dropped from both the begining and end of the dataset (i.e. if an observation is taken every 5 minutes, then <code>head = 6</code>and <code>tail = 6</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dr_drop.html">dr_drop</a></span>(df, <span class="dv">6</span>, <span class="dv">6</span>)</code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#equations">Equations</a></li>
      <li><a href="#using-driftr">Using driftR</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Andrew Shaughnessy, Christopher Prener, Elizabeth Hasenmueller.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
