<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tidy Evaluation in driftR • driftR</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">driftR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/driftR.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/TidyEval.html">Tidy Evaluation in driftR</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/shaughnessyar/driftR">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Tidy Evaluation in driftR</h1>
                        <h4 class="author">Christopher Prener</h4>
            
            <h4 class="date">2017-10-24</h4>
          </div>

    
    
<div class="contents">
<p><code>driftR</code> implements <a href="http://rlang.tidyverse.org/articles/tidy-evaluation.html">tidy evaluation</a>, an opinionated approach to capturing and processing expressions using <a href="https://www.tidyverse.org"><code>tidyverse</code></a> packages <a href="http://dplyr.tidyverse.org"><code>dplyr</code></a> and <a href="http://rlang.tidyverse.org"><code>rlang</code></a>. These packages are automatically installed when you install <code>driftR</code> if they are not already packages you use. This article is meant to be a quick introduction to tidy eval for users who have not encountered it before.</p>
<div id="the-tidyverse" class="section level2">
<h2 class="hasAnchor">
<a href="#the-tidyverse" class="anchor"></a>The <code>tidyverse</code>
</h2>
<p>The <a href="https://www.tidyverse.org"><code>tidyverse</code></a> is a group of packages the provide a shared grammar and philosophy for conducting many of the most common tasks in data analysis: cleaning and wrangling data, and visualizing data by creating plots and figures. The <code>tidyverse</code> is made up of a number of packages, including:</p>
<ul>
<li>
<a href="http://ggplot2.tidyverse.org"><code>ggplot2</code></a> - a set of tools for implementing the <a href="http://vita.had.co.nz/papers/layered-grammar.pdf">Grammar of Graphics</a>
</li>
<li>
<a href="http://dplyr.tidyverse.org"><code>dplyr</code></a> - a set of common verbs for cleaning and wrangling data</li>
<li>
<a href="http://tidyr.tidyverse.org"><code>tidyr</code></a> - functions for consistently tidying data so that “(1) each variable is in a column, (2) each observation is in a row, and (3) each value is a cell”</li>
<li>
<a href="http://tibble.tidyverse.org"><code>tibble</code></a> - a re-imagining of <code>R</code>’s data frame</li>
<li>
<a href="http://rlang.tidyverse.org"><code>rlang</code></a> - a set of programming tools for writing <code>dplyr</code>-like functions</li>
</ul>
<p>As I noted above, <code>driftR</code> is built on <a href="http://dplyr.tidyverse.org"><code>dplyr</code></a> and <a href="http://rlang.tidyverse.org"><code>rlang</code></a> in both literal and philosophical terms. Like <code>dplyr</code>, <code>driftR</code> is built around the idea of verbs for wrangling data. While <code>dplyr</code>’s verbs are meant to be general, <code>driftR</code>’s verbs are specifically tailored for correcting water-quality monitoring data.</p>
<p>In order to implement this philosophical, verb-driven approach to data cleaning, <code>driftR</code> provides a set of wrappers around two <code>dplyr</code> functions - <code>mutate()</code> for adding new variables and <code>slice()</code> for removing rows. When you call a <code>drifR</code> function, you are actually calling one or more linked instances of <code>mutate()</code> or <code>slice()</code> that perform specific tasks with particular inputs in a standardized order.</p>
<p>Like the <code>tidyverse</code>, then, <code>driftR</code> is opinionated. The verbs that are used are implemented in specific ways meant to ensure that the data cleaning process for water-quality monitoring output is consistent and highly reproducibile. While <code>driftR</code> does enforce a specific workflow on users, the trade-off is the package’s consistency and speed (relative to other, non-reproducible methods like cleaning these data in a spreadsheet application!).</p>
</div>
<div id="some-sample-data" class="section level2">
<h2 class="hasAnchor">
<a href="#some-sample-data" class="anchor"></a>Some Sample Data</h2>
<p>The following examples use these data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">driftData &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">Date =</span> <span class="kw">c</span>(<span class="st">"9/18/2015"</span>, <span class="st">"9/18/2015"</span>, <span class="st">"9/18/2015"</span>, <span class="st">"9/18/2015"</span>, <span class="st">"9/18/2015"</span>, <span class="st">"9/18/2015"</span>),
  <span class="dt">Time =</span> <span class="kw">c</span>(<span class="st">"12:10:49"</span>, <span class="st">"12:15:50"</span>, <span class="st">"12:20:51"</span>, <span class="st">"12:25:51"</span>, <span class="st">"12:30:51"</span>, <span class="st">"12:35:51"</span>),
  <span class="dt">Temp =</span> <span class="kw">c</span>(<span class="fl">14.76</span>, <span class="fl">14.64</span>, <span class="fl">14.57</span>, <span class="fl">14.51</span>, <span class="fl">14.50</span>, <span class="fl">14.63</span>),
  <span class="dt">SpCond =</span> <span class="kw">c</span>(<span class="fl">0.754</span>, <span class="fl">0.750</span>, <span class="fl">0.750</span>, <span class="fl">0.749</span>, <span class="fl">0.749</span>, <span class="fl">0.749</span>),
  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>
)</code></pre></div>
</div>
<div id="quoting" class="section level2">
<h2 class="hasAnchor">
<a href="#quoting" class="anchor"></a>Quoting</h2>
<p>One advantage of using a tidy evaluation approach for packages is that it offers a more flexible way to accept inputs from end users.</p>
<div id="a-quick-example" class="section level3">
<h3 class="hasAnchor">
<a href="#a-quick-example" class="anchor"></a>A Quick Example</h3>
<p>Many of the base <code>R</code> functions use the <code>$</code> symbol to differentiate between data frames and variables within them. The <code>mean()</code> function from the <code>stats</code> package provides an example of this behavior:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">mean</span>(driftData<span class="op">$</span>Temp)
[<span class="dv">1</span>] <span class="fl">14.60167</span></code></pre></div>
<p>Packages that are built on top of <code>tidyverse</code> functions often separate the data frame parameter from the variable parameter in their structure. For instance, we could write a “wrapper” around the <code>mean()</code> function that accepts the data frame and variable parameters separately:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidyMean &lt;-<span class="st"> </span><span class="cf">function</span>(data, variable){
  <span class="kw">mean</span>(data[[variable]])
}</code></pre></div>
<p>This has consequences for how users interact with the function, however. If users do not quote the variable parameter, they will receive an error that the an object with the name of the input variable cannot be found:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">tidyMean</span>(driftData, Temp)
  Error <span class="cf">in</span> (<span class="cf">function</span>(x, i, exact) <span class="cf">if</span> (<span class="kw">is.matrix</span>(i)) <span class="kw">as.matrix</span>(x)[[i]] <span class="cf">else</span> <span class="kw">.subset2</span>(x,  <span class="op">:</span><span class="st"> </span>
<span class="st">   </span>object <span class="st">'Temp'</span> not found </code></pre></div>
<p>If end users <em>do</em> quote the input parameter, the function will evaluate successfully:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">tidyMean</span>(driftData, <span class="st">"Temp"</span>)
[<span class="dv">1</span>] <span class="fl">14.60167</span></code></pre></div>
<p>This, of course, increases the cognitive burden on new users of <code>R</code> who are still learning how all of this works. There are other common examples of where this occurs in the <code>R</code> ecosystem. For example, the <code>install.packages()</code> function requires that package names be quoted while the <code>library()</code> function accepts either quoted <em>or</em> unquoted names.</p>
</div>
<div id="tidy-evaluation-in-driftr" class="section level3">
<h3 class="hasAnchor">
<a href="#tidy-evaluation-in-driftr" class="anchor"></a>Tidy Evaluation in <code>driftR</code>
</h3>
<p><code>driftR</code> makes use of tidy evaluation to work around this issue. All <code>driftR</code> functions will accept variable names as parameters that are either quoted <em>or</em> unquoted.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"driftR"</span>)

<span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="../reference/dr_factor.html">dr_factor</a></span>(driftData, <span class="dt">corrFactor =</span> corrFac, 
            <span class="dt">dateVar =</span> Date, <span class="dt">timeVar =</span> Time, <span class="dt">format =</span> <span class="st">"MDY"</span>)
<span class="co">#        Date     Time  Temp SpCond   corrFac</span>
<span class="co"># 1 9/18/2015 12:10:49 14.76  0.754 0.0000000</span>
<span class="co"># 2 9/18/2015 12:15:50 14.64  0.750 0.2003995</span>
<span class="co"># 3 9/18/2015 12:20:51 14.57  0.750 0.4007989</span>
<span class="co"># 4 9/18/2015 12:25:51 14.51  0.749 0.6005326</span>
<span class="co"># 5 9/18/2015 12:30:51 14.50  0.749 0.8002663</span>
<span class="co"># 6 9/18/2015 12:35:51 14.63  0.749 1.0000000</span>

<span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="../reference/dr_factor.html">dr_factor</a></span>(driftData, <span class="dt">corrFactor =</span> <span class="st">"corrFac"</span>, 
            <span class="dt">dateVar =</span> <span class="st">"Date"</span>, <span class="dt">timeVar =</span> <span class="st">"Time"</span>, <span class="dt">format =</span> <span class="st">"MDY"</span>)
<span class="co">#        Date     Time  Temp SpCond   corrFac</span>
<span class="co"># 1 9/18/2015 12:10:49 14.76  0.754 0.0000000</span>
<span class="co"># 2 9/18/2015 12:15:50 14.64  0.750 0.2003995</span>
<span class="co"># 3 9/18/2015 12:20:51 14.57  0.750 0.4007989</span>
<span class="co"># 4 9/18/2015 12:25:51 14.51  0.749 0.6005326</span>
<span class="co"># 5 9/18/2015 12:30:51 14.50  0.749 0.8002663</span>
<span class="co"># 6 9/18/2015 12:35:51 14.63  0.749 1.0000000</span></code></pre></div>
<p>This mirrors the behavior of [<code>tidyverse</code>] functions.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#the-tidyverse">The <code>tidyverse</code></a></li>
      <li><a href="#some-sample-data">Some Sample Data</a></li>
      <li><a href="#quoting">Quoting</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Andrew Shaughnessy, Christopher Prener, Elizabeth Hasenmueller.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
